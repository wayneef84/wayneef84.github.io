# ðŸš¨ Critical Code Review & Action Items

**Target Audience:** Claude Code (C)
**Priority:** High
**Context:** Enforcing strict ES5 compatibility (no build step) and solving CORS blockers.

---

## 1. ðŸ›‘ Critical Syntax Violations (ES5 Compatibility)
The project strictly forbids ES6+ syntax to ensure "no build step" compatibility on older engines. The following modern syntax crept into `js/normalizer.js` and MUST be refactored.

* **Spread Operator (`...`)**
    * **Location:** `js/normalizer.js` -> `prepareForStorage()`
    * **Issue:** `...data` causes syntax errors in ES5 environments.
    * **Fix:** Use a helper function or `Object.assign` polyfill to copy properties manually.

* **Optional Chaining (`?.`)**
    * **Location:** `js/normalizer.js` -> `mergeUpdate()`
    * **Issue:** `existing.metadata?.queriesCount` causes syntax errors.
    * **Fix:** Expand to explicit checks: `(existing.metadata && existing.metadata.queriesCount)`.

## 2. ðŸš§ Network Architecture Blocker (CORS)
* **Location:** `js/api/dhl.js` (and future FedEx/UPS adapters)
* **Issue:** The `trackDirect` function attempts `fetch()` calls from the browser to carrier APIs. These APIs do not support CORS for browser origins, so these calls will fail immediately on `localhost` or GitHub Pages.
* **Action:** The "Direct Mode" is functionally impossible without a proxy. We must prioritize the Cloudflare Worker implementation (see `proxy/cloudflare-worker.js` below).

## 3. ðŸ”’ Security Best Practice
* **Issue:** Currently, `index.html` accepts "Client Secrets" (FedEx). In a pure BYOK model, these are stored in IndexedDB.
* **Risk:** While safe on the user's device, sending these secrets over the wire to a proxy requires trust.
* **Recommendation:** Ensure the Proxy (below) is configured to *only* allow requests from `wayneef84.github.io` and `localhost` to prevent others from using the user's keys via your proxy.

---